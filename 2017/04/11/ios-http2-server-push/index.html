<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="李剑飞" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/avatar2.png?v=5.1.0" />






<meta name="description" content="HTTP/2 Server Push 是什么当用户的浏览器和服务器在建立链接后，服务器主动将一些资源推送给浏览器并缓存起来，这样当浏览器接下来请求这些资源时就直接从缓存中读取，不会在从服务器上拉了，提升了速率。举一个例子就是： 假如一个页面有3个资源文件index.html,index.css,index.js,当浏览器请求index.html的时候，服务器不仅返回index.html的内容，同">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS  HTTP/2 Server Push 探索">
<meta property="og:url" content="http://www.lijianfei.cn/2017/04/11/ios-http2-server-push/index.html">
<meta property="og:site_name" content="李剑飞的博客">
<meta property="og:description" content="HTTP/2 Server Push 是什么当用户的浏览器和服务器在建立链接后，服务器主动将一些资源推送给浏览器并缓存起来，这样当浏览器接下来请求这些资源时就直接从缓存中读取，不会在从服务器上拉了，提升了速率。举一个例子就是： 假如一个页面有3个资源文件index.html,index.css,index.js,当浏览器请求index.html的时候，服务器不仅返回index.html的内容，同">
<meta property="og:image" content="http://7xraw1.com1.z0.glb.clouddn.com/20170411149190414882815.jpg">
<meta property="og:image" content="http://7xraw1.com1.z0.glb.clouddn.com/20170411149190039117815.png">
<meta property="og:image" content="http://7xraw1.com1.z0.glb.clouddn.com/20170411149190121682527.png">
<meta property="og:updated_time" content="2017-04-11T10:01:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS  HTTP/2 Server Push 探索">
<meta name="twitter:description" content="HTTP/2 Server Push 是什么当用户的浏览器和服务器在建立链接后，服务器主动将一些资源推送给浏览器并缓存起来，这样当浏览器接下来请求这些资源时就直接从缓存中读取，不会在从服务器上拉了，提升了速率。举一个例子就是： 假如一个页面有3个资源文件index.html,index.css,index.js,当浏览器请求index.html的时候，服务器不仅返回index.html的内容，同">
<meta name="twitter:image" content="http://7xraw1.com1.z0.glb.clouddn.com/20170411149190414882815.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.lijianfei.cn/2017/04/11/ios-http2-server-push/"/>





  <title> iOS  HTTP/2 Server Push 探索 | 李剑飞的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  











  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1260409211&web_id=1260409211" language="JavaScript"></script>
  </div>






  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李剑飞的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.lijianfei.cn/2017/04/11/ios-http2-server-push/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李剑飞">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李剑飞的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                iOS  HTTP/2 Server Push 探索
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-11T18:00:50+08:00">
                2017-04-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://7xraw1.com1.z0.glb.clouddn.com/20170411149190414882815.jpg" alt="HTTP/2"></p>
<h1 id="HTTP-2-Server-Push-是什么"><a href="#HTTP-2-Server-Push-是什么" class="headerlink" title="HTTP/2 Server Push 是什么"></a>HTTP/2 Server Push 是什么</h1><p>当用户的浏览器和服务器在建立链接后，服务器主动将一些资源推送给浏览器并缓存起来，这样当浏览器接下来请求这些资源时就直接从缓存中读取，不会在从服务器上拉了，提升了速率。举一个例子就是：</p>
<p>假如一个页面有3个资源文件index.html,index.css,index.js,当浏览器请求index.html的时候，服务器不仅返回index.html的内容，同时将index.css和index.js的内容push给浏览器，当浏览器下次请求这2两个文件时就可以直接从缓存中读取了。</p>
<p>如下图所示:<br><img src="http://7xraw1.com1.z0.glb.clouddn.com/20170411149190039117815.png" alt="Apple-http2ServerPush"></p>
<h1 id="HTTP-2-Server-Push-原理是什么"><a href="#HTTP-2-Server-Push-原理是什么" class="headerlink" title="HTTP/2 Server Push 原理是什么"></a>HTTP/2 Server Push 原理是什么</h1><p>要想了解server push原理，首先要理解一些概念。我们知道HTTP/2传输的格式并不像HTTP1使用文本来传输，而是启用了二进制帧(Frames)格式来传输，和server push相关的帧主要分成这几种类型：</p>
<ol>
<li>HEADERS frame(请求返回头帧):这种帧主要携带的http请求头信息，和HTTP1的header类似。</li>
<li>DATA frames(数据帧) :这种帧存放真正的数据content，用来传输。</li>
<li>PUSH_PROMISE frame(推送帧):这种帧是由server端发送给client的帧，用来表示server push的帧，这种帧是实现server push的主要帧类型。</li>
<li>RST_STREAM(取消推送帧):这种帧表示请求关闭帧，简单讲就是当client不想接受某些资源或者接受timeout时会向发送方发送此帧，和PUSH_PROMISE frame一起使用时表示拒绝或者关闭server push。</li>
</ol>
<p>(PS:HTTP/2相关的帧其实包括<a href="https://tools.ietf.org/html/rfc7540#section-11.2" target="_blank" rel="external">10种帧</a>，正是因为底层数据格式的改变，才为HTTP/2带来许多的特性，帧的引入不仅有利于压缩数据，也有利于数据的安全性和可靠传输性。)</p>
<p>了解了相关的帧类型，下面就是具体server push的实现过程了：</p>
<ol>
<li>由多路复用我们可以知道HTTP/2中对于同一个域名的请求会使用一条tcp链接而用不同的stream ID来区分各自的请求。</li>
<li>当client使用stream 1请求index.html时，server正常处理index.html的请求，并可以得知index.html页面还将要会请求index.css和index.js。</li>
<li>server使用stream 1发送PUSH_PROMISE frame给client告诉client我这边可以使用stream 2来推送index.js和stream 3来推送index.css资源。</li>
<li>server使用stream 1正常的发送HEADERS frame和DATA frames将index.html的内容返回给client。</li>
<li>client接收到PUSH_PROMISE frame得知stream 2和stream 3来接收推送资源。</li>
<li>server拿到index.css和index.js便会发送HEADERS frame和DATA frames将资源发送给client。</li>
<li>client拿到push的资源后会缓存起来当请求这个资源时会从直接从从缓存中读取。</li>
</ol>
<h1 id="Server-Push-怎么用"><a href="#Server-Push-怎么用" class="headerlink" title="Server Push 怎么用"></a>Server Push 怎么用</h1><h2 id="使用-nghttp2-调试-HTTP-2-流量"><a href="#使用-nghttp2-调试-HTTP-2-流量" class="headerlink" title="使用 nghttp2 调试 HTTP/2 流量"></a>使用 nghttp2 调试 HTTP/2 流量</h2><p>查看 HTTP/2 流量的几种方式</p>
<ul>
<li>在 Chrome 地址栏输入 <code>chrome://net-internals/#http2</code>，使用 Chrome 自带的 HTTP/2 调试工具；<br>使用方便，但受限于 Chrome 浏览器，对于 Chrome 不支持的 h2c（HTTP/2 Cleartext，没有部署 TLS 的 HTTP/2）协议无能为力。同时，这个工具显示的信息经过了解析和筛选，不够全面。</li>
<li>使用 Wireshark 调试 HTTP/2 流量；<br>Wireshark 位于服务端和浏览器之间，充当的是中间人角色，用它查看 HTTP/2 over HTTPS 流量时，必须拥有网站私钥或者借助浏览器共享对称密钥，才能解密 TLS 流量，配置起来比较麻烦。</li>
</ul>
<p>nghttp2，是一个用 C 实现的 HTTP/2 库，支持 h2c。它可以做为其它软件的一部分，为其提供 HTTP/2 相关功能（例如 curl 的 HTTP/2 功能就是用的 nghttp2）。除此之外，它还提供了四个有用的 HTTP/2 工具：</p>
<ul>
<li>nghttp：HTTP/2 客户端；</li>
<li>nghttpd：HTTP/2 服务端；</li>
<li>nghttpx：HTTP/2 代理，提供 HTTP/1、HTTP/2 等协议之间的转换；</li>
<li>h2load：HTTP/2 性能测试工具；　</li>
</ul>
<h3 id="nghttp2-安装"><a href="#nghttp2-安装" class="headerlink" title="nghttp2 安装"></a>nghttp2 安装</h3><p>先来用 brew 看一下有没有 nghttp 相关的库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">~ brew search nghttp</div><div class="line">nghttp2</div></pre></td></tr></table></figure></p>
<p>看来是有 nghttp2 的，再用 brew 看下需要安装哪些环境：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">~ brew info nghttp2</div><div class="line">nghttp2: stable 1.21.0 (bottled), HEAD</div><div class="line">HTTP/2 C Library</div><div class="line">https://nghttp2.org/</div><div class="line">Not installed</div><div class="line">From: https://github.com/Homebrew/homebrew-core/blob/master/Formula/nghttp2.rb</div><div class="line">==&gt; Dependencies</div><div class="line">Build: sphinx-doc ✘, pkg-config ✔, cunit ✘</div><div class="line">Required: c-ares ✘, libev ✘, openssl ✔, libevent ✘, jansson ✘, boost ✘, spdylay ✘</div><div class="line">Recommended: jemalloc ✘</div><div class="line">==&gt; Requirements</div><div class="line">Optional: python3 ✔</div><div class="line">==&gt; Options</div><div class="line">--with-examples</div><div class="line">Compile and install example programs</div><div class="line">--with-python3</div><div class="line">Build python3 bindings</div><div class="line">--without-docs</div><div class="line">Don&apos;t build man pages</div><div class="line">--without-jemalloc</div><div class="line">Build without jemalloc support</div><div class="line">--HEAD</div><div class="line">Install HEAD version</div></pre></td></tr></table></figure></p>
<p>看来需要的依赖还挺多。</p>
<p>使用 brew 安装 nghttp2 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install nghttp2</div></pre></td></tr></table></figure></p>
<p>一切妥当后，nghttp2 提供的几个工具就可以直接用了。</p>
<h3 id="nghttp"><a href="#nghttp" class="headerlink" title="nghttp"></a>nghttp</h3><p>nghttp 做为一个功能完整的 HTTP/2 客户端，非常适合用来查看和调试 HTTP/2 流量。它支持的参数很多，通过官方文档或者 nghttp -h 都能查看。最常用几个参数如下：</p>
<ul>
<li>-v, –verbose，输出完整的 debug 信息；</li>
<li>-n, –null-out，丢弃下载的数据；</li>
<li>-a, –get-assets，下载 html 中的 css、js、image 等外链资源；</li>
<li>-H, –header = &lt; HEADER &gt;，添加请求头部字段，如 -H’:method: PUT’；</li>
<li>-u, –upgrade，使用 HTTP 的 Upgrade 机制来协商 HTTP/2 协议，用于 h2c，详见下面的例子；</li>
</ul>
<p>以下是使用 nghttp 访问 <a href="https://h2o.examp1e.net" target="_blank" rel="external">https://h2o.examp1e.net</a> 的结果。从调试信息中可以清晰看到 h2c 协商以及 Server Push 的整个过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div></pre></td><td class="code"><pre><div class="line">nghttp -nv &apos;https://h2o.examp1e.net&apos;</div><div class="line">[  0.201] Connected</div><div class="line">The negotiated protocol: h2</div><div class="line">[  1.180] send SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;</div><div class="line">(niv=2)</div><div class="line">[SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]</div><div class="line">[SETTINGS_INITIAL_WINDOW_SIZE(0x04):65535]</div><div class="line">[  1.180] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=3&gt;</div><div class="line">(dep_stream_id=0, weight=201, exclusive=0)</div><div class="line">[  1.180] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=5&gt;</div><div class="line">(dep_stream_id=0, weight=101, exclusive=0)</div><div class="line">[  1.180] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=7&gt;</div><div class="line">(dep_stream_id=0, weight=1, exclusive=0)</div><div class="line">[  1.180] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=9&gt;</div><div class="line">(dep_stream_id=7, weight=1, exclusive=0)</div><div class="line">[  1.180] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=11&gt;</div><div class="line">(dep_stream_id=3, weight=1, exclusive=0)</div><div class="line">[  1.180] send HEADERS frame &lt;length=39, flags=0x25, stream_id=13&gt;</div><div class="line">; END_STREAM | END_HEADERS | PRIORITY</div><div class="line">(padlen=0, dep_stream_id=11, weight=16, exclusive=0)</div><div class="line">; Open new stream</div><div class="line">:method: GET</div><div class="line">:path: /</div><div class="line">:scheme: https</div><div class="line">:authority: h2o.examp1e.net</div><div class="line">accept: */*</div><div class="line">accept-encoding: gzip, deflate</div><div class="line">user-agent: nghttp2/1.21.1</div><div class="line">[  1.373] recv SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;</div><div class="line">(niv=2)</div><div class="line">[SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]</div><div class="line">[SETTINGS_INITIAL_WINDOW_SIZE(0x04):16777216]</div><div class="line">[  1.373] recv SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;</div><div class="line">; ACK</div><div class="line">(niv=0)</div><div class="line">[  1.373] recv (stream_id=13) :method: GET</div><div class="line">[  1.373] recv (stream_id=13) :scheme: https</div><div class="line">[  1.373] recv (stream_id=13) :authority: h2o.examp1e.net</div><div class="line">[  1.373] recv (stream_id=13) :path: /search/jquery-1.9.1.min.js</div><div class="line">[  1.373] recv (stream_id=13) accept: */*</div><div class="line">[  1.373] recv (stream_id=13) accept-encoding: gzip, deflate</div><div class="line">[  1.373] recv (stream_id=13) user-agent: nghttp2/1.21.1</div><div class="line">[  1.373] recv PUSH_PROMISE frame &lt;length=59, flags=0x04, stream_id=13&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0, promised_stream_id=2)</div><div class="line">[  1.373] recv (stream_id=2) :status: 200</div><div class="line">[  1.373] recv (stream_id=2) server: h2o/2.2.0-beta2</div><div class="line">[  1.373] recv (stream_id=2) date: Mon, 10 Apr 2017 06:30:29 GMT</div><div class="line">[  1.373] recv (stream_id=2) content-type: application/javascript</div><div class="line">[  1.373] recv (stream_id=2) last-modified: Thu, 14 May 2015 04:10:14 GMT</div><div class="line">[  1.373] recv (stream_id=2) etag: &quot;55542026-169d5&quot;</div><div class="line">[  1.373] recv (stream_id=2) accept-ranges: bytes</div><div class="line">[  1.373] recv (stream_id=2) x-http2-push: pushed</div><div class="line">[  1.373] recv (stream_id=2) content-length: 92629</div><div class="line">[  1.373] recv HEADERS frame &lt;length=126, flags=0x04, stream_id=2&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0)</div><div class="line">; First push response header</div><div class="line">[  1.373] recv (stream_id=13) :method: GET</div><div class="line">[  1.373] recv (stream_id=13) :scheme: https</div><div class="line">[  1.373] recv (stream_id=13) :authority: h2o.examp1e.net</div><div class="line">[  1.373] recv (stream_id=13) :path: /search/oktavia-jquery-ui.js</div><div class="line">[  1.373] recv (stream_id=13) accept: */*</div><div class="line">[  1.373] recv (stream_id=13) accept-encoding: gzip, deflate</div><div class="line">[  1.373] recv (stream_id=13) user-agent: nghttp2/1.21.1</div><div class="line">[  1.373] recv PUSH_PROMISE frame &lt;length=33, flags=0x04, stream_id=13&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0, promised_stream_id=4)</div><div class="line">[  1.373] recv (stream_id=4) :status: 200</div><div class="line">[  1.373] recv (stream_id=4) server: h2o/2.2.0-beta2</div><div class="line">[  1.373] recv (stream_id=4) date: Mon, 10 Apr 2017 06:30:29 GMT</div><div class="line">[  1.373] recv (stream_id=4) content-type: application/javascript</div><div class="line">[  1.373] recv (stream_id=4) last-modified: Thu, 14 May 2015 04:10:14 GMT</div><div class="line">[  1.373] recv (stream_id=4) etag: &quot;55542026-1388&quot;</div><div class="line">[  1.373] recv (stream_id=4) accept-ranges: bytes</div><div class="line">[  1.374] recv (stream_id=4) x-http2-push: pushed</div><div class="line">[  1.374] recv (stream_id=4) content-length: 5000</div><div class="line">[  1.374] recv HEADERS frame &lt;length=28, flags=0x04, stream_id=4&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0)</div><div class="line">; First push response header</div><div class="line">[  1.374] recv (stream_id=13) :method: GET</div><div class="line">[  1.374] recv (stream_id=13) :scheme: https</div><div class="line">[  1.374] recv (stream_id=13) :authority: h2o.examp1e.net</div><div class="line">[  1.374] recv (stream_id=13) :path: /search/oktavia-english-search.js</div><div class="line">[  1.374] recv (stream_id=13) accept: */*</div><div class="line">[  1.374] recv (stream_id=13) accept-encoding: gzip, deflate</div><div class="line">[  1.374] recv (stream_id=13) user-agent: nghttp2/1.21.1</div><div class="line">[  1.374] recv PUSH_PROMISE frame &lt;length=35, flags=0x04, stream_id=13&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0, promised_stream_id=6)</div><div class="line">[  1.374] recv (stream_id=6) :status: 200</div><div class="line">[  1.374] recv (stream_id=6) server: h2o/2.2.0-beta2</div><div class="line">[  1.374] recv (stream_id=6) date: Mon, 10 Apr 2017 06:30:29 GMT</div><div class="line">[  1.374] recv (stream_id=6) content-type: application/javascript</div><div class="line">[  1.374] recv (stream_id=6) last-modified: Thu, 14 May 2015 04:10:14 GMT</div><div class="line">[  1.374] recv (stream_id=6) etag: &quot;55542026-34dd6&quot;</div><div class="line">[  1.374] recv (stream_id=6) accept-ranges: bytes</div><div class="line">[  1.374] recv (stream_id=6) x-http2-push: pushed</div><div class="line">[  1.374] recv (stream_id=6) content-length: 216534</div><div class="line">[  1.374] recv HEADERS frame &lt;length=31, flags=0x04, stream_id=6&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0)</div><div class="line">; First push response header</div><div class="line">[  1.374] recv (stream_id=13) :method: GET</div><div class="line">[  1.374] recv (stream_id=13) :scheme: https</div><div class="line">[  1.374] recv (stream_id=13) :authority: h2o.examp1e.net</div><div class="line">[  1.374] recv (stream_id=13) :path: /assets/style.css</div><div class="line">[  1.374] recv (stream_id=13) accept: */*</div><div class="line">[  1.374] recv (stream_id=13) accept-encoding: gzip, deflate</div><div class="line">[  1.374] recv (stream_id=13) user-agent: nghttp2/1.21.1</div><div class="line">[  1.374] recv PUSH_PROMISE frame &lt;length=24, flags=0x04, stream_id=13&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0, promised_stream_id=8)</div><div class="line">[  1.374] recv (stream_id=8) :status: 200</div><div class="line">[  1.374] recv (stream_id=8) server: h2o/2.2.0-beta2</div><div class="line">[  1.374] recv (stream_id=8) date: Mon, 10 Apr 2017 06:30:29 GMT</div><div class="line">[  1.374] recv (stream_id=8) content-type: text/css</div><div class="line">[  1.374] recv (stream_id=8) last-modified: Tue, 20 Sep 2016 05:27:06 GMT</div><div class="line">[  1.374] recv (stream_id=8) etag: &quot;57e0c8aa-1586&quot;</div><div class="line">[  1.374] recv (stream_id=8) accept-ranges: bytes</div><div class="line">[  1.374] recv (stream_id=8) x-http2-push: pushed</div><div class="line">[  1.374] recv (stream_id=8) content-length: 5510</div><div class="line">[  1.374] recv HEADERS frame &lt;length=58, flags=0x04, stream_id=8&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0)</div><div class="line">; First push response header</div><div class="line">[  1.374] recv (stream_id=13) :method: GET</div><div class="line">[  1.374] recv (stream_id=13) :scheme: https</div><div class="line">[  1.374] recv (stream_id=13) :authority: h2o.examp1e.net</div><div class="line">[  1.374] recv (stream_id=13) :path: /assets/searchstyle.css</div><div class="line">[  1.374] recv (stream_id=13) accept: */*</div><div class="line">[  1.374] recv (stream_id=13) accept-encoding: gzip, deflate</div><div class="line">[  1.374] recv (stream_id=13) user-agent: nghttp2/1.21.1</div><div class="line">[  1.374] recv PUSH_PROMISE frame &lt;length=28, flags=0x04, stream_id=13&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0, promised_stream_id=10)</div><div class="line">[  1.374] recv (stream_id=10) :status: 200</div><div class="line">[  1.374] recv (stream_id=10) server: h2o/2.2.0-beta2</div><div class="line">[  1.374] recv (stream_id=10) date: Mon, 10 Apr 2017 06:30:29 GMT</div><div class="line">[  1.374] recv (stream_id=10) content-type: text/css</div><div class="line">[  1.374] recv (stream_id=10) last-modified: Tue, 20 Sep 2016 05:27:06 GMT</div><div class="line">[  1.374] recv (stream_id=10) etag: &quot;57e0c8aa-8dd&quot;</div><div class="line">[  1.374] recv (stream_id=10) accept-ranges: bytes</div><div class="line">[  1.374] recv (stream_id=10) x-http2-push: pushed</div><div class="line">[  1.374] recv (stream_id=10) content-length: 2269</div><div class="line">[  1.374] recv HEADERS frame &lt;length=27, flags=0x04, stream_id=10&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0)</div><div class="line">; First push response header</div><div class="line">[  1.374] recv (stream_id=13) :status: 200</div><div class="line">[  1.374] recv (stream_id=13) server: h2o/2.2.0-beta2</div><div class="line">[  1.374] recv (stream_id=13) date: Mon, 10 Apr 2017 06:30:29 GMT</div><div class="line">[  1.374] recv (stream_id=13) link: &lt;/search/jquery-1.9.1.min.js&gt;; rel=preload</div><div class="line">[  1.374] recv (stream_id=13) link: &lt;/search/oktavia-jquery-ui.js&gt;; rel=preload</div><div class="line">[  1.374] recv (stream_id=13) link: &lt;/search/oktavia-english-search.js&gt;; rel=preload</div><div class="line">[  1.374] recv (stream_id=13) link: &lt;/assets/style.css&gt;; rel=preload</div><div class="line">[  1.374] recv (stream_id=13) link: &lt;/assets/searchstyle.css&gt;; rel=preload</div><div class="line">[  1.374] recv (stream_id=13) cache-control: no-cache</div><div class="line">[  1.374] recv (stream_id=13) content-type: text/html</div><div class="line">[  1.374] recv (stream_id=13) last-modified: Wed, 05 Apr 2017 06:55:14 GMT</div><div class="line">[  1.374] recv (stream_id=13) etag: &quot;58e494d2-1665&quot;</div><div class="line">[  1.374] recv (stream_id=13) accept-ranges: bytes</div><div class="line">[  1.374] recv (stream_id=13) set-cookie: h2o_casper=AmgAAAAAAAAAAAAYxfEYAAABSA; Path=/; Expires=Tue, 01 Jan 2030 00:00:00 GMT; Secure</div><div class="line">[  1.374] recv (stream_id=13) content-length: 5733</div><div class="line">[  1.374] recv HEADERS frame &lt;length=304, flags=0x04, stream_id=13&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0)</div><div class="line">; First response header</div><div class="line">[  1.375] send SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;</div><div class="line">; ACK</div><div class="line">(niv=0)</div><div class="line">[  1.566] recv DATA frame &lt;length=16137, flags=0x00, stream_id=2&gt;</div><div class="line">[  1.567] recv DATA frame &lt;length=5000, flags=0x01, stream_id=4&gt;</div><div class="line">; END_STREAM</div><div class="line">[  1.567] recv DATA frame &lt;length=4915, flags=0x00, stream_id=6&gt;</div><div class="line">[  1.766] recv DATA frame &lt;length=2829, flags=0x00, stream_id=8&gt;</div><div class="line">[  1.766] recv DATA frame &lt;length=2269, flags=0x01, stream_id=10&gt;</div><div class="line">; END_STREAM</div><div class="line">[  1.766] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=33120)</div><div class="line">[  1.767] recv DATA frame &lt;length=9065, flags=0x00, stream_id=2&gt;</div><div class="line">[  1.970] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  1.970] recv DATA frame &lt;length=2681, flags=0x01, stream_id=8&gt;</div><div class="line">; END_STREAM</div><div class="line">[  1.971] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=2&gt;</div><div class="line">(window_size_increment=33855)</div><div class="line">[  1.971] recv DATA frame &lt;length=10072, flags=0x00, stream_id=2&gt;</div><div class="line">[  2.172] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  2.172] recv DATA frame &lt;length=4248, flags=0x00, stream_id=2&gt;</div><div class="line">[  2.173] recv DATA frame &lt;length=4248, flags=0x00, stream_id=6&gt;</div><div class="line">[  2.173] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=34002)</div><div class="line">[  2.173] recv DATA frame &lt;length=4248, flags=0x00, stream_id=2&gt;</div><div class="line">[  2.577] recv DATA frame &lt;length=4248, flags=0x00, stream_id=6&gt;</div><div class="line">[  2.578] recv DATA frame &lt;length=2829, flags=0x00, stream_id=2&gt;</div><div class="line">[  2.579] recv DATA frame &lt;length=12762, flags=0x00, stream_id=6&gt;</div><div class="line">[  2.777] recv DATA frame &lt;length=2829, flags=0x00, stream_id=2&gt;</div><div class="line">[  2.777] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=6&gt;</div><div class="line">(window_size_increment=33241)</div><div class="line">[  2.778] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  3.177] recv DATA frame &lt;length=8505, flags=0x00, stream_id=2&gt;</div><div class="line">[  3.177] recv DATA frame &lt;length=5667, flags=0x00, stream_id=6&gt;</div><div class="line">[  3.177] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=33993)</div><div class="line">[  3.177] recv DATA frame &lt;length=2829, flags=0x00, stream_id=2&gt;</div><div class="line">[  3.177] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  3.378] recv DATA frame &lt;length=2829, flags=0x00, stream_id=2&gt;</div><div class="line">[  3.579] recv DATA frame &lt;length=11343, flags=0x00, stream_id=6&gt;</div><div class="line">[  3.580] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=34002)</div><div class="line">[  3.580] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=2&gt;</div><div class="line">(window_size_increment=33984)</div><div class="line">[  3.583] recv DATA frame &lt;length=7086, flags=0x00, stream_id=2&gt;</div><div class="line">[  3.779] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  4.186] recv DATA frame &lt;length=7086, flags=0x00, stream_id=2&gt;</div><div class="line">[  4.186] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  4.186] recv DATA frame &lt;length=2829, flags=0x00, stream_id=2&gt;</div><div class="line">[  4.395] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  4.396] recv DATA frame &lt;length=2829, flags=0x00, stream_id=2&gt;</div><div class="line">[  4.602] recv DATA frame &lt;length=5667, flags=0x00, stream_id=6&gt;</div><div class="line">[  4.602] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=6&gt;</div><div class="line">(window_size_increment=33993)</div><div class="line">[  4.602] recv DATA frame &lt;length=2829, flags=0x00, stream_id=2&gt;</div><div class="line">[  4.602] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=33975)</div><div class="line">[  4.808] recv DATA frame &lt;length=4248, flags=0x00, stream_id=6&gt;</div><div class="line">[  4.809] recv DATA frame &lt;length=6379, flags=0x01, stream_id=2&gt;</div><div class="line">; END_STREAM</div><div class="line">[  5.010] recv DATA frame &lt;length=3536, flags=0x00, stream_id=6&gt;</div><div class="line">[  5.420] recv DATA frame &lt;length=8505, flags=0x00, stream_id=6&gt;</div><div class="line">[  5.420] recv DATA frame &lt;length=5667, flags=0x00, stream_id=6&gt;</div><div class="line">[  5.628] recv DATA frame &lt;length=4248, flags=0x00, stream_id=6&gt;</div><div class="line">[  5.842] recv DATA frame &lt;length=4248, flags=0x00, stream_id=6&gt;</div><div class="line">[  5.842] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  5.842] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=34002)</div><div class="line">[  5.842] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=6&gt;</div><div class="line">(window_size_increment=33281)</div><div class="line">[  6.057] recv DATA frame &lt;length=4248, flags=0x00, stream_id=6&gt;</div><div class="line">[  6.273] recv DATA frame &lt;length=8505, flags=0x00, stream_id=6&gt;</div><div class="line">[  6.490] recv DATA frame &lt;length=9924, flags=0x00, stream_id=6&gt;</div><div class="line">[  6.490] recv DATA frame &lt;length=4248, flags=0x00, stream_id=6&gt;</div><div class="line">[  6.706] recv DATA frame &lt;length=4248, flags=0x00, stream_id=6&gt;</div><div class="line">[  6.706] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=34002)</div><div class="line">[  6.706] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=6&gt;</div><div class="line">(window_size_increment=34002)</div><div class="line">[  6.924] recv DATA frame &lt;length=8505, flags=0x00, stream_id=6&gt;</div><div class="line">[  7.141] recv DATA frame &lt;length=8505, flags=0x00, stream_id=6&gt;</div><div class="line">[  7.361] recv DATA frame &lt;length=8505, flags=0x00, stream_id=6&gt;</div><div class="line">[  7.361] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=34020)</div><div class="line">[  7.574] recv DATA frame &lt;length=9924, flags=0x00, stream_id=6&gt;</div><div class="line">[  7.574] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=6&gt;</div><div class="line">(window_size_increment=34029)</div><div class="line">[  7.787] recv DATA frame &lt;length=9924, flags=0x00, stream_id=6&gt;</div><div class="line">[  7.787] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  7.998] recv DATA frame &lt;length=7086, flags=0x00, stream_id=6&gt;</div><div class="line">[  8.210] recv DATA frame &lt;length=9924, flags=0x00, stream_id=6&gt;</div><div class="line">[  8.210] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;</div><div class="line">(window_size_increment=34011)</div><div class="line">[  8.210] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=6&gt;</div><div class="line">(window_size_increment=34011)</div><div class="line">[  8.425] recv DATA frame &lt;length=11343, flags=0x00, stream_id=6&gt;</div><div class="line">[  8.426] recv DATA frame &lt;length=2829, flags=0x00, stream_id=6&gt;</div><div class="line">[  8.426] recv DATA frame &lt;length=4053, flags=0x01, stream_id=6&gt;</div><div class="line">; END_STREAM</div><div class="line">[  8.631] recv DATA frame &lt;length=4443, flags=0x00, stream_id=13&gt;</div><div class="line">[  8.633] recv DATA frame &lt;length=1290, flags=0x01, stream_id=13&gt;</div><div class="line">; END_STREAM</div><div class="line">[  8.633] send GOAWAY frame &lt;length=8, flags=0x00, stream_id=0&gt;</div><div class="line">(last_stream_id=10, error_code=NO_ERROR(0x00), opaque_data(0)=[])</div></pre></td></tr></table></figure>
<p>当然，我们也可以使用 <code>grep</code> 搜索出来 server push 的相关 stream：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">nghttp -nv &apos;https://h2o.examp1e.net&apos; | grep &apos;PUSH_PROMISE&apos;</div><div class="line">[  1.582] recv PUSH_PROMISE frame &lt;length=59, flags=0x04, stream_id=13&gt;</div><div class="line">[  1.582] recv PUSH_PROMISE frame &lt;length=33, flags=0x04, stream_id=13&gt;</div><div class="line">[  1.582] recv PUSH_PROMISE frame &lt;length=35, flags=0x04, stream_id=13&gt;</div><div class="line">[  1.582] recv PUSH_PROMISE frame &lt;length=24, flags=0x04, stream_id=13&gt;</div><div class="line">[  1.582] recv PUSH_PROMISE frame &lt;length=28, flags=0x04, stream_id=13&gt;</div></pre></td></tr></table></figure>
<h2 id="使用-NodeJS-搭建-HTTP-2-服务器"><a href="#使用-NodeJS-搭建-HTTP-2-服务器" class="headerlink" title="使用 NodeJS 搭建 HTTP/2 服务器"></a>使用 NodeJS 搭建 HTTP/2 服务器</h2><p>在大前端的时代背景下，客户端开发不会点 JavaScript 都快混不下去了，笔者前段时间在我司前端轮岗了两周，再加上之前也写过 ReactNative，但还是感觉前端变化之快领人咋舌，革命尚未结束，同志仍需努力啊。</p>
<p>咱们直接上代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">var http2 = require(&apos;http2&apos;);// http2</div><div class="line">var url=require(&apos;url&apos;); // https://www.npmjs.com/package/url</div><div class="line">var fs=require(&apos;fs&apos;); // https://www.npmjs.com/package/fs</div><div class="line">var mine=require(&apos;mine&apos;);</div><div class="line">var path=require(&apos;path&apos;); // 路径</div><div class="line"></div><div class="line">var server = http2.createServer(&#123;</div><div class="line">key: fs.readFileSync(&apos;./localhost.key&apos;),</div><div class="line">cert: fs.readFileSync(&apos;./localhost.crt&apos;)</div><div class="line">&#125;, function(request, response) &#123;</div><div class="line"></div><div class="line">// var pathname = url.parse(request.url).pathname;</div><div class="line">var realPath = &apos;./push.json&apos; ;//path.join(pathname,&quot;push.json&quot;);    //这里设置自己的文件路径，这是该次response返回的内容;</div><div class="line"></div><div class="line">var pushArray = [];</div><div class="line">var ext = path.extname(realPath);</div><div class="line">ext = ext ? ext.slice(1) : &apos;unknown&apos;;</div><div class="line">var contentType = mine[ext] || &quot;text/plain&quot;;</div><div class="line"></div><div class="line">if (fs.existsSync(realPath)) &#123;</div><div class="line"></div><div class="line">console.log(&apos;success&apos;)</div><div class="line">response.writeHead(200, &#123;</div><div class="line">&apos;Content-Type&apos;: contentType</div><div class="line">&#125;);</div><div class="line"></div><div class="line">response.write(fs.readFileSync(realPath,&apos;binary&apos;));</div><div class="line"></div><div class="line">// 注意 push 路径必须是绝对路径，这是该次 server push 返回的内容</div><div class="line">var pushItem = response.push(&apos;/Users/f.li/Desktop/http2-nodeServer/newpush.json&apos;, &#123;</div><div class="line">response: &#123;</div><div class="line">&apos;content-type&apos;: contentType</div><div class="line">&#125;    </div><div class="line">&#125;);</div><div class="line">pushItem.end(fs.readFileSync(&apos;/Users/f.li/Desktop/http2-nodeServer/newpush.json&apos;,&apos;binary&apos;),()=&gt;&#123;</div><div class="line">console.log(&apos;newpush end&apos;)</div><div class="line">&#125;);</div><div class="line"></div><div class="line">response.end();</div><div class="line"></div><div class="line">&#125; else &#123;</div><div class="line">response.writeHead(404, &#123;</div><div class="line">&apos;Content-Type&apos;: &apos;text/plain&apos;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">response.write(&quot;This request URL &quot; + realPath + &quot; was not found on this server.&quot;);</div><div class="line">response.end();</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(3000, function() &#123;</div><div class="line">console.log(&apos;listen on 3000&apos;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这里需要注意几点：</p>
<ul>
<li>创建http2的nodejs服务必须时基于https的，因为现在主流的浏览器都要支持SSL/TLS的http2，证书和私钥可以自己通过<a href="https://www.openssl.org/" target="_blank" rel="external">OPENSSL</a>生成。</li>
<li>node http2的相关api和正常的node httpserver相同，可以直接使用。</li>
</ul>
<p>使用 nghttp 测试一下我们的代码有没有进行 server push：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">~ nghttp -nv &apos;https://localhost:3000/&apos;</div><div class="line">[  0.007] Connected</div><div class="line">The negotiated protocol: h2</div><div class="line">[  0.029] recv SETTINGS frame &lt;length=0, flags=0x00, stream_id=0&gt;</div><div class="line">(niv=0)</div><div class="line">[  0.029] send SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;</div><div class="line">(niv=2)</div><div class="line">[SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]</div><div class="line">[SETTINGS_INITIAL_WINDOW_SIZE(0x04):65535]</div><div class="line">[  0.029] send SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;</div><div class="line">; ACK</div><div class="line">(niv=0)</div><div class="line">[  0.029] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=3&gt;</div><div class="line">(dep_stream_id=0, weight=201, exclusive=0)</div><div class="line">[  0.029] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=5&gt;</div><div class="line">(dep_stream_id=0, weight=101, exclusive=0)</div><div class="line">[  0.029] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=7&gt;</div><div class="line">(dep_stream_id=0, weight=1, exclusive=0)</div><div class="line">[  0.029] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=9&gt;</div><div class="line">(dep_stream_id=7, weight=1, exclusive=0)</div><div class="line">[  0.029] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=11&gt;</div><div class="line">(dep_stream_id=3, weight=1, exclusive=0)</div><div class="line">[  0.029] send HEADERS frame &lt;length=38, flags=0x25, stream_id=13&gt;</div><div class="line">; END_STREAM | END_HEADERS | PRIORITY</div><div class="line">(padlen=0, dep_stream_id=11, weight=16, exclusive=0)</div><div class="line">; Open new stream</div><div class="line">:method: GET</div><div class="line">:path: /</div><div class="line">:scheme: https</div><div class="line">:authority: localhost:3000</div><div class="line">accept: */*</div><div class="line">accept-encoding: gzip, deflate</div><div class="line">user-agent: nghttp2/1.21.1</div><div class="line">[  0.043] recv SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;</div><div class="line">; ACK</div><div class="line">(niv=0)</div><div class="line">[  0.049] recv (stream_id=13) :status: 200</div><div class="line">[  0.049] recv (stream_id=13) content-type: text/plain</div><div class="line">[  0.049] recv (stream_id=13) date: Tue, 11 Apr 2017 08:34:46 GMT</div><div class="line">[  0.049] recv HEADERS frame &lt;length=34, flags=0x04, stream_id=13&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0)</div><div class="line">; First response header</div><div class="line">[  0.049] recv DATA frame &lt;length=35, flags=0x00, stream_id=13&gt;</div><div class="line">[  0.049] recv (stream_id=13) :method: GET</div><div class="line">[  0.049] recv (stream_id=13) :scheme: https</div><div class="line">[  0.050] recv (stream_id=13) :authority: localhost:3000</div><div class="line">[  0.050] recv (stream_id=13) :path: /Users/f.li/Desktop/http2-nodeServer/newpush.json</div><div class="line">[  0.050] recv PUSH_PROMISE frame &lt;length=56, flags=0x04, stream_id=13&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0, promised_stream_id=2)</div><div class="line">[  0.050] recv DATA frame &lt;length=0, flags=0x01, stream_id=13&gt;</div><div class="line">; END_STREAM</div><div class="line">[  0.050] recv (stream_id=2) :status: 200</div><div class="line">[  0.050] recv (stream_id=2) date: Tue, 11 Apr 2017 08:34:46 GMT</div><div class="line">[  0.050] recv HEADERS frame &lt;length=2, flags=0x04, stream_id=2&gt;</div><div class="line">; END_HEADERS</div><div class="line">(padlen=0)</div><div class="line">; First push response header</div><div class="line">[  0.050] recv DATA frame &lt;length=21, flags=0x00, stream_id=2&gt;</div><div class="line">[  0.050] recv DATA frame &lt;length=0, flags=0x01, stream_id=2&gt;</div><div class="line">; END_STREAM</div><div class="line">[  0.050] send GOAWAY frame &lt;length=8, flags=0x00, stream_id=0&gt;</div><div class="line">(last_stream_id=2, error_code=NO_ERROR(0x00), opaque_data(0)=[])</div></pre></td></tr></table></figure></p>
<p>看到了 PUSH_PROMISE 的帧，说明进行了 server push。</p>
<p>同样也可以使用chrome查看 server push，如下图所示：<br><img src="http://7xraw1.com1.z0.glb.clouddn.com/20170411149190121682527.png" alt="chrome 查看 http2 server push"></p>
<p>服务端介绍基本完毕。下面我们来介绍一些 iOS 客户端对 Server Push 的使用。</p>
<h2 id="iOS-使用-HTTP-2-Server-Push"><a href="#iOS-使用-HTTP-2-Server-Push" class="headerlink" title="iOS 使用 HTTP/2 Server Push"></a>iOS 使用 HTTP/2 Server Push</h2><p>Apple 在这方面做的很好，基本实现了客户端无感调用http/2 server push。但是笔者查看了些许资料，现在只有iOS 10 支持 http/2。</p>
<p>直接上代码吧：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()&lt;NSURLSessionDelegate&gt;</div><div class="line"></div><div class="line">@property(nonatomic,strong)NSURLSession *session;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">[super viewDidLoad];</div><div class="line">// Do any additional setup after loading the view, typically from a nib.</div><div class="line"></div><div class="line">&#125;</div><div class="line">#pragma mark - Touch</div><div class="line">- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event</div><div class="line">&#123;</div><div class="line">[self urlSession];</div><div class="line">&#125;</div><div class="line">#pragma mark - 发送请求</div><div class="line">- (void)urlSession</div><div class="line">&#123;</div><div class="line">NSURL *url = [NSURL URLWithString:@&quot;https://localhost:3000&quot;];</div><div class="line"></div><div class="line">//发送HTTPS请求是需要对网络会话设置代理的</div><div class="line">_session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration] delegate:self delegateQueue:[NSOperationQueue mainQueue]];</div><div class="line"></div><div class="line">NSURLSessionDataTask *dataTask = [_session dataTaskWithURL:url completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123;</div><div class="line">NSLog(@&quot;%@&quot;,[[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]);</div><div class="line">// 收到该次请求后，立即请求下次的内容</div><div class="line">[self urlSessionPush];</div><div class="line"></div><div class="line">&#125;];</div><div class="line"></div><div class="line">[dataTask resume];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)urlSessionPush</div><div class="line">&#123;</div><div class="line">NSURL *url = [NSURL URLWithString:@&quot;https://localhost:3000/Users/f.li/Desktop/http2-nodeServer/newpush.json&quot;];</div><div class="line">NSURLSessionDataTask *dataTask = [_session dataTaskWithURL:url completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123;</div><div class="line">NSLog(@&quot;%@&quot;,[[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]);</div><div class="line">&#125;];</div><div class="line">[dataTask resume];</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - URLSession Delegate</div><div class="line">- (void)URLSession:(NSURLSession *)session didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition, NSURLCredential * _Nullable))completionHandler</div><div class="line">&#123;</div><div class="line">// 这里还要设置下 plist 中设置 ATS</div><div class="line">if (![challenge.protectionSpace.authenticationMethod isEqualToString:@&quot;NSURLAuthenticationMethodServerTrust&quot;])</div><div class="line">&#123;</div><div class="line">return;</div><div class="line">&#125;</div><div class="line">NSURLCredential *credential = [[NSURLCredential alloc] initWithTrust:challenge.protectionSpace.serverTrust];</div><div class="line">completionHandler(NSURLSessionAuthChallengeUseCredential,credential);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didFinishCollectingMetrics:(NSURLSessionTaskMetrics *)metrics</div><div class="line">&#123;</div><div class="line">NSArray *fetchTypes = @[ @&quot;Unknown&quot;, @&quot;Network Load&quot;, @&quot;Server Push&quot;, @&quot;Local Cache&quot;];</div><div class="line"></div><div class="line">for(NSURLSessionTaskTransactionMetrics *transactionMetrics in [metrics transactionMetrics])</div><div class="line">&#123;</div><div class="line"></div><div class="line">NSLog(@&quot;protocol[%@] reuse[%d] fetch:%@ - %@&quot;, [transactionMetrics networkProtocolName], [transactionMetrics isReusedConnection], fetchTypes[[transactionMetrics resourceFetchType]], [[transactionMetrics request] URL]);</div><div class="line"></div><div class="line">if([transactionMetrics resourceFetchType] == NSURLSessionTaskMetricsResourceFetchTypeServerPush)</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;Asset was server pushed&quot;);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)didReceiveMemoryWarning</div><div class="line">&#123;</div><div class="line">[super didReceiveMemoryWarning];</div><div class="line">// Dispose of any resources that can be recreated.</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>分别看下服务端和客户端的Log:<br>客户端：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Http2ServerPush[2525:274943] protocol[h2] reuse[0] fetch:Network Load - https://localhost:3000/</div><div class="line">Http2ServerPush[2525:274943] &#123;&quot;message&quot;:&quot; http2.0 server is ok&quot;&#125;</div><div class="line">Http2ServerPush[2525:274943] protocol[h2] reuse[1] fetch:Server Push - https://localhost:3000/Users/f.li/Desktop/http2-nodeServer/newpush.json</div><div class="line">Http2ServerPush[2525:274943] Asset was server pushed</div><div class="line">Http2ServerPush[2525:274943] &#123;&quot;message&quot;:&quot;newPush&quot;&#125;</div></pre></td></tr></table></figure></p>
<p>服务端：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">http2-nodeServer npm start</div><div class="line"></div><div class="line">&gt; http2-nodeServer@1.0.0 start /Users/f.li/Desktop/http2-nodeServer</div><div class="line">&gt; node index.js</div><div class="line"></div><div class="line">listen on 3000</div><div class="line">success</div><div class="line">newpush end</div></pre></td></tr></table></figure></p>
<p>看来确实是客户端发出了两次请求，但是服务端只响应了一次（该次响应+ server push）</p>
<h1 id="本文相关Demo"><a href="#本文相关Demo" class="headerlink" title="本文相关Demo"></a>本文相关Demo</h1><ul>
<li><a href="https://github.com/lijianfeigeek/iOS-HTTP-2-Server-Push" target="_blank" rel="external">Github:lijianfeigeek</a></li>
</ul>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul>
<li><a href="http://www.alloyteam.com/2017/01/http2-server-push-research/" target="_blank" rel="external">HTTP2 Server Push的研究 | AlloyTeam</a></li>
<li><a href="https://imququ.com/post/intro-to-nghttp2.html" target="_blank" rel="external">使用 nghttp2 调试 HTTP/2 流量 | JerryQu 的小站</a></li>
<li><a href="http://stackoverflow.com/questions/40755758/http-2-server-push-in-ios-10" target="_blank" rel="external">objective c - HTTP/2 Server Push in iOS 10 - Stack Overflow</a></li>
<li><a href="http://www.jianshu.com/p/d833ac6fa5ab" target="_blank" rel="external">使用NSURLSession或者AFN发送HTTPS请求 - 简书</a></li>
</ul>

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/jianfeishuo.jpg" alt="李剑飞 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎订阅我的微信公众号"剑飞说"！</div>
</div>


      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechatpay.png" alt="李剑飞 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay.png" alt="李剑飞 Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      李剑飞
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://www.lijianfei.cn/2017/04/11/ios-http2-server-push/" title="iOS  HTTP/2 Server Push 探索">http://www.lijianfei.cn/2017/04/11/ios-http2-server-push/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/01/09/ios-abtest-explore/" rel="prev" title="iOS A/B Test 方案探索">
                iOS A/B Test 方案探索 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="李剑飞" />
          <p class="site-author-name" itemprop="name">李剑飞</p>
           
              <p class="site-description motion-element" itemprop="description">本站没有添加评论，扫二维码加我微信好友，咨询文章的疑问点。本站只发布原创内容，我的学习笔记会记录在下面的 Wiki 链接中。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lijianfeigeek" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/1855052150" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/lijianfei_" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/lijianfeigeek/lijianfeigeek.github.io/wiki" target="_blank" title="Wiki">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Wiki
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lijianfei.deercv.com/" target="_blank" title="Resume">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Resume
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#HTTP-2-Server-Push-是什么"><span class="nav-number">1.</span> <span class="nav-text">HTTP/2 Server Push 是什么</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTTP-2-Server-Push-原理是什么"><span class="nav-number">2.</span> <span class="nav-text">HTTP/2 Server Push 原理是什么</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Server-Push-怎么用"><span class="nav-number">3.</span> <span class="nav-text">Server Push 怎么用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-nghttp2-调试-HTTP-2-流量"><span class="nav-number">3.1.</span> <span class="nav-text">使用 nghttp2 调试 HTTP/2 流量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nghttp2-安装"><span class="nav-number">3.1.1.</span> <span class="nav-text">nghttp2 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nghttp"><span class="nav-number">3.1.2.</span> <span class="nav-text">nghttp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-NodeJS-搭建-HTTP-2-服务器"><span class="nav-number">3.2.</span> <span class="nav-text">使用 NodeJS 搭建 HTTP/2 服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#iOS-使用-HTTP-2-Server-Push"><span class="nav-number">3.3.</span> <span class="nav-text">iOS 使用 HTTP/2 Server Push</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#本文相关Demo"><span class="nav-number">4.</span> <span class="nav-text">本文相关Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考文献"><span class="nav-number">5.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李剑飞</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
